## タスク管理

### タスクの更新ルール
1. 機能の実装後に、毎回 @todo.md を確認＆更新をしてください。
2. 私が言わなくても中身は随時更新するようにしてください。

### タスク一覧

#### 🔵 初期設定と環境構築
- [x] 🔴 Next.js プロジェクトのセットアップ (TypeScript, ESLint, Prettier 含む)
  - 依存関係: なし
  - 見積時間: 2h
- [x] 🟡 必要なライブラリのインストール (`dev-rules/tech-stack.mdc` 準拠: Shadcn/ui, Tailwind CSS, Radix UI, Lucide React, date-fns, Prisma, Zod 等)
  - 依存関係: Next.js プロジェクトセットアップ完了
  - 見積時間: 1h
- [x] 🟢 基本的なディレクトリ構造の作成 (`dev-rules/nextjs.mdc` 準拠)
  - 依存関係: Next.js プロジェクトセットアップ完了
  - 見積時間: 0.5h
- [x] 🟡 ローカルデータベース (SQLite) のセットアップと Prisma の初期設定
  - 依存関係: Next.js プロジェクトセットアップ完了
  - 見積時間: 1.5h
- [ ] ⚪ エラーハンドリング (`error.tsx`, `not-found.tsx`) の設定
  - 詳細: ルートおよび各セグメントレベルでのエラー処理ページの作成
  - 依存関係: プロジェクトセットアップ完了
  - 見積時間: 1h
- [ ] ⚪ ローディング状態 (`loading.tsx`, Suspense) の設定
  - 詳細: ルートおよび各セグメントレベルでのローディングUI、Suspense境界の設定
  - 依存関係: プロジェクトセットアップ完了
  - 見積時間: 1.5h

#### 🔵 データ処理とAPI準備 (またはサーバーコンポーネントでのデータフェッチ準備)
- [x] 🔴 提供されたCSVデータ (`Data/2019_travelers.csv`, `Data/2024_travelers.csv`) の分析とスキーマ検討
  - 詳細: データ構造確認。月別データ存在を確認。スキーマ案定義済み。注釈行・集計行の処理、2024年版の余分な列の処理に注意。
  - 依存関係: なし (プロジェクトセットアップと並行可)
  - 見積時間: 1h
- [x] 🟡 Prisma スキーマ定義 (`requiment.md` のテーブル表示カラムを参考に `CountryVisitor` モデル等を作成)
  - 依存関係: CSVデータ分析完了、Prisma初期設定完了
  - 見積時間: 1h
- [x] 🟢 CSVデータをデータベースにインポートするスクリプトの作成と実行 (Prisma Seed等)
  - 依存関係: Prismaスキーマ定義完了
  - 見積時間: 2h
- [x] 🟡 データアクセスロジック (DAL) の基本実装 (`src/dal/visitors.ts` 等)
  - 詳細: 国別旅行者データを取得する基本的な関数群
  - 依存関係: Prismaスキーマ定義完了
  - 見積時間: 1.5h

#### 🔵 コア機能実装: テーブル表示 (`requiment.md` 5.1)
- [x] 🟡 テーブル表示用メインページコンポーネント作成 (`src/app/(dashboard)/visitors/page.tsx`)
  - 依存関係: DAL基本実装完了
  - 見積時間: 1h
- [x] 🟡 テーブル表示用サーバーコンポーネント作成 (`src/components/features/visitors/VisitorsTable.tsx`)
  - 詳細: サーバーコンポーネントとしてDALからデータを取得し表示
  - カラム: 月、国名、2019年旅行者数、2024年旅行者数、差分、増減率
  - 依存関係: DAL基本実装完了
  - 見積時間: 2h
- [x] 🟢 テーブルのソート機能実装 (差分、増減率、国名、月順)
  - 依存関係: テーブル表示コンポーネント作成完了
  - 見積時間: 2h
- [x] 🟢 テーブルのページネーション機能実装
  - 依存関係: テーブル表示コンポーネント作成完了
  - 見積時間: 1.5h

#### 🔵 コア機能実装: 折れ線グラフ比較 (`requiment.md` 5.2)
- [x] 🟡 グラフライブラリ (Chart.js or Recharts等を検討・導入)
  - 依存関係: プロジェクトセットアップ完了
  - 見積時間: 1h
- [x] 🟡 折れ線グラフ表示用クライアントコンポーネント作成 (`src/components/features/visitors/VisitorsLineChart.tsx`)
  - 詳細: 選択国の2019年/2024年月別旅行者数を表示
  - 依存関係: グラフライブラリ導入、DAL基本実装完了
  - 見積時間: 3h
- [x] 🟢 グラフのホバー時ツールチップ表示
  - 依存関係: 折れ線グラフ表示コンポーネント作成完了
  - 見積時間: 1h
- [x] 🟡 国選択UI (ドロップダウン等をShadcn/uiで実装) とグラフ連携
  - 依存関係: 折れ線グラフ表示コンポーネント作成完了
  - 見積時間: 2h

#### 🔵 コア機能実装: ヒートマップ表示 (`requiment.md` 5.3)
- [x] 🟡 ヒートマップ表示用クライアントコンポーネント作成 (`src/components/features/visitors/VisitorsHeatmap.tsx`)
  - 軸: 縦:国、横:月。セル値: 差分 or 増減率 (選択可能)
  - 依存関係: グラフライブラリ導入 (または別のヒートマップライブラリ)、DAL基本実装完了
  - 見積時間: 3h
- [x] 🟢 ヒートマップのカラースケール実装とカラーバー表示
  - 依存関係: ヒートマップ表示コンポーネント作成完了
  - 見積時間: 1.5h

#### 🔵 コア機能実装: フィルタ・検索 (`requiment.md` 5.4)
- [x] 🟡 国名検索 (インクリメンタルサーチ) の実装 (テーブル・グラフ連携)
  - 依存関係: テーブル表示、グラフ表示コンポーネント作成完了
  - 見積時間: 2h
- [x] 🟢 上位N抽出機能 (差分/増減率) の実装 (テーブル・グラフ連携)
  - 依存関係: テーブル表示、グラフ表示コンポーネント作成完了
  - 見積時間: 2h
- [x] 🟢 月選択フィルタの実装 (テーブル・グラフ連携)
  - 依存関係: テーブル表示、グラフ表示コンポーネント作成完了
  - 見積時間: 1.5h

#### 🔵 UI/UX調整と全体的な仕上げ
- [x] 🟢 Shadcn/ui を活用したUIコンポーネントの適用と全体的なデザイン調整
  - 詳細: Shadcn/uiテーマ設定(tailwind.config.ts, globals.css)、ダークモード基本対応。
  - 依存関係: 各コンポーネント作成完了
  - 見積時間: 3h
- [x] ⚪ レスポンシブデザインの確認と調整
  - 依存関係: UI調整完了
  - 見積時間: 2h
- [x] 🟢 全体的な動作確認と軽微なバグ修正
  - 詳細: 実装された機能の連携確認、表示の微調整など。
  - 依存関係: 全機能実装完了
  - 見積時間: 2h

#### 🔵 (オプション) 追加機能・改善
- [ ] ⚪ 国別年間入国者数ランキング棒グラフ表示
  - 詳細: 指定年の国別年間総入国者数を棒グラフでランキング表示。年選択、上位N件選択機能も検討。
  - 依存関係: DAL実装
  - 見積時間: 3h
- [ ] ⚪ (オプション) 月範囲スライダーの実装 (折れ線グラフ)
  - 詳細: 主要機能実装後に検討。
  - 依存関係: 折れ線グラフ表示コンポーネント作成完了
  - 見積時間: 1.5h
- [ ] ⚪ (オプション) セルクリックで該当国・月の詳細モーダル表示 (ヒートマップ)
  - 詳細: 主要機能実装後に検討。
  - 依存関係: ヒートマップ表示コンポーネント作成完了
  - 見積時間: 2h
- [ ] ⚪ ダークモード切替機能の実装
  - 詳細: ThemeProvider (next-themes) と切り替えUIの設置
  - 依存関係: Shadcn/uiテーマ設定完了
  - 見積時間: 1.5h
- [ ] ⚪ テーブル/グラフデータのエクスポート機能 (CSV, PNG等)
  - 見積時間: 2.5h
- [~] ⚪ Prisma Seedスクリプトの堅牢性向上とデータ検証
  - 詳細: 2024年CSVのパースロジックを修正し、国名抽出の精度を向上。ログ出力を強化し、処理状況の可視性を向上させた。
  - 状況: 2024年データが2019年と同等の432件取得できるようになったことを確認。
  - 見積時間: 1.5h
- [ ] ⚪ UI/UXのさらなる詳細調整 (アニメーション、トランジション、アクセシビリティ向上等)
  - 見積時間: 3h

#### 🔵 非機能要件の確認とテスト
- [ ] 🟡 レスポンス速度のテストと基本的な最適化
  - 依存関係: 全機能実装完了
  - 見積時間: 2h
- [ ] 🟡 基本的な動作テスト (主要ブラウザ Chrome/Safari/Edge)
  - 依存関係: 全機能実装完了
  - 見積時間: 3h
- [ ] 🟢 型安全性の確認 (TypeScriptエラーがないこと)
  - 依存関係: 全機能実装完了
  - 見積時間: 1h

#### 🔵 ドキュメンテーションとデプロイ準備
- [ ] 🟢 基本的なREADMEの作成 (プロジェクト概要、起動方法など)
  - 依存関係: プロジェクトセットアップ完了
  - 見積時間: 1h
- [ ] 🟡 Vercelへのデプロイ準備とテストデプロイ
  - 依存関係: 全機能実装完了
  - 見積時間: 2h

---
### メモ
- `Data/a1_travel_expenditure_by_country.csv` は旅行支出データ。現要件では直接使用しないが、将来的な機能拡張で関連データとして利用可能性あり。
- 2024年のシードデータが少ない問題は解決済み。(`prisma/seed.js`のパースロジック改善により、2019年と同等のデータ件数を取得できるようになった)。
- 大量データ時のパフォーマンスについては、現状クライアントサイドでのソート・フィルタが多いため、データ量が増加した場合はサーバーサイド処理への移行を検討。 